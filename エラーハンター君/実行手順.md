# エラーハンター君 実行手順

## クイックスタート（30秒で開始）

```bash
# 1. エラー報告テンプレートをコピー
cp エラーハンター君/templates/error-report.md my-error-report.md

# 2. エラー情報を記入
vi my-error-report.md

# 3. 統括エージェントに報告
# （Claude Codeで開いているターミナルから実行）
cat my-error-report.md | claude --agent 統括エージェント
```

## エラー報告テンプレート

### テンプレートファイル: `templates/error-report.md`

```markdown
# エラー報告

## 症状
[エラーの症状を1行で記述]

例: `npm run build`実行時にTypeErrorが発生しビルドが失敗する

## 期待値
[正常に動作した場合の挙動]

例: ビルドが成功してdistフォルダが生成される

## 実際の挙動
[実際に起こったこと]

例: TypeError: Cannot read property 'map' of undefined

## 再現手順
[CLIで再生できる形式で記載]

```bash
npm install
npm run build
```

## 発生頻度
[100% / 50% / 稀 のいずれか]

例: 100%（毎回発生）

## 影響範囲
[影響を受ける機能やユーザー]

例: ビルド全体が停止、開発環境のみ（本番未デプロイ）

## 直近の変更
[関連するコミットID、PR番号]

例: PR #123（Listコンポーネントのリファクタリング）

## 代表ログ
[エラーログの先頭〜"caused by"付近まで]

```
Error: Build failed with 1 error:
src/components/List.tsx:45:12: error: Cannot read property 'map' of undefined
    at failureErrorWithLog
```

## 環境情報
[OS/ランタイム/依存バージョン]

```
OS: macOS 14.0
Node.js: v18.17.0
TypeScript: 5.3.3
```

## 優先度の事情
[期限/影響/回避策の有無]

例: 本番デプロイが2時間後に予定されている、回避策なし
```

## 詳細な実行フロー

### Phase 1: エラー報告の提出

#### 方法1: Claude Code経由（推奨）
```bash
# Claude Codeで開いている状態で
cat my-error-report.md

# 統括エージェントのプロンプトを貼り付けて実行
# （エラーハンター君/01_統括エージェント.md の内容）
```

#### 方法2: コピー＆ペースト
1. `エラーハンター君/01_統括エージェント.md` を開く
2. プロンプトセクションをコピー
3. Claude Codeのチャットに貼り付け
4. エラー報告内容を追記
5. 実行

#### 方法3: ファイル添付
```bash
# Claude Codeのチャット欄に直接ドラッグ＆ドロップ
# または以下のコマンド
claude chat --attach my-error-report.md --agent 統括エージェント
```

### Phase 2: エージェント軍団の自動実行

統括エージェントが自動的に以下を実行します：

```
[統括エージェント] エラー報告を受付
    ↓
[症状分析エージェント] 症状を詳細分析（5分）
    ↓
[根本原因特定エージェント] 真因を特定（10分）
    ↓
[修正パッチ作成エージェント] 修正を実装（8分）
    ↓
[テスト作成エージェント] テストを作成（7分）
    ↓
[再発防止エージェント] 恒久対策を実装（5分）
    ↓
[統括エージェント] 最終報告を統合
```

**合計所要時間**: 約35分（MTTR < 2時間を達成）

### Phase 3: 成果物の確認

統括エージェントから以下の成果物が返却されます：

1. **エラー解析・修正レポート**
   - 要約（原因・対応・影響）
   - 根拠（ログ・コード引用・決定打）
   - 修正パッチ（diff形式）
   - テスト（実行可能なコード）
   - 検証コマンド
   - リスクとロールバック手順
   - 再発防止策

2. **実行可能なファイル**
   - 修正パッチ（`*.patch`）
   - テストコード（`*.test.ts`）
   - 設定ファイル（`.eslintrc.js`等）

### Phase 4: 修正の適用

#### 自動適用（推奨）
```bash
# パッチファイルが生成されている場合
git apply error-fix.patch

# テスト実行
npm run test

# ビルド確認
npm run build
```

#### 手動適用
```bash
# 各ファイルを手動で編集
vi src/components/List.tsx
vi src/types/index.ts

# 確認
git diff
```

### Phase 5: 検証とデプロイ

```bash
# 1. テスト実行
npm run test:unit
npm run test:integration
npm run test:e2e

# 2. Lint/Type check
npm run lint
npm run type-check

# 3. ビルド
npm run build

# 4. コミット
git add .
git commit -m "Fix: [統括エージェントが生成したコミットメッセージ]"

# 5. PR作成
gh pr create --title "Fix: ..." --body "[レポートを貼り付け]"

# 6. CI確認
gh pr checks

# 7. マージ
gh pr merge

# 8. デプロイ
npm run deploy
```

## トラブルシューティング

### Q1: エージェントが正しく動作しない

**A1**: プロンプトの形式を確認してください

```bash
# 正しい形式
[エラー報告の内容]

あなたはエラーハンター君軍団の統括エージェントです。
[プロンプト全文]
```

### Q2: 修正パッチが適用できない

**A2**: Git conflictを解決してください

```bash
# 現在の差分を確認
git status

# コンフリクト解消
git add [conflicted-file]

# パッチ再適用
git apply --reject error-fix.patch
```

### Q3: テストが失敗する

**A3**: テスト作成エージェントに再依頼してください

```markdown
以下のテストが失敗しています。修正してください。

[失敗したテストの出力]
```

### Q4: 再発防止策が過剰

**A4**: 必要なものだけ選択実装してください

```markdown
再発防止策のうち、以下のみ実装します：
- [ ] 監視項目の追加
- [x] ESLintルール追加
- [x] 型定義の厳密化
- [ ] Zodバリデーション
```

## カスタマイズ

### エージェントのカスタマイズ

各エージェントのプロンプトは自由に編集できます：

```bash
# 統括エージェントのカスタマイズ
vi エラーハンター君/01_統括エージェント.md

# 症状分析エージェントのカスタマイズ
vi エラーハンター君/02_症状分析エージェント.md
```

### プロジェクト固有のルール追加

```markdown
# プロジェクト固有ルールの追加例

## 追加ルール
- 必ずJiraチケットを作成
- Slackの#dev-alertsに通知
- デプロイ前にQAチームのレビュー必須
```

### CI/CDとの統合

#### GitHub Actions例
```yaml
# .github/workflows/error-hunter.yml
name: Error Hunter

on:
  issues:
    types: [labeled]

jobs:
  analyze:
    if: contains(github.event.issue.labels.*.name, 'bug')
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Run Error Hunter
        run: |
          # エラー報告をIssueから抽出
          echo "${{ github.event.issue.body }}" > error-report.md

          # 統括エージェントに投げる
          claude --agent 統括エージェント < error-report.md > result.md

      - name: Comment Result
        uses: peter-evans/create-or-update-comment@v3
        with:
          issue-number: ${{ github.event.issue.number }}
          body-path: result.md
```

## ベストプラクティス

### 1. エラー報告は詳細に
- 再現手順は必ずCLI形式で
- ログは全文ではなく該当箇所のみ
- 環境情報は正確に

### 2. 優先度判定を正確に
- P0: サービス停止、データ破損、セキュリティ侵害
- P1: 主要機能の不全、多数のユーザーに影響
- P2: 一部機能の不具合、回避策あり
- P3: マイナーな問題、優先度低

### 3. 修正は最小差分で
- 1つの原因に対して1つの修正
- 不要なリファクタリングは避ける
- テストと同時に実装

### 4. 必ずテストを追加
- 回帰テストは必須
- エッジケースも網羅
- カバレッジ > 80%を維持

### 5. 再発防止まで完遂
- 監視項目の追加
- 静的解析の強化
- ドキュメント更新

## 成功指標（KPI）

| 指標 | 目標値 | 測定方法 |
|------|--------|----------|
| **MTTR** | < 2時間 | エラー報告〜修正完了 |
| **再発率** | < 5% | 同一エラーの再発件数 |
| **カバレッジ** | > 80% | テストカバレッジ |
| **ロールバック率** | < 1% | 緊急ロールバック件数 |

## まとめ

エラーハンター君を使えば、以下が実現できます：

✅ **最速のエラー解決** - MTTR < 2時間
✅ **最小差分の修正** - ロールバック容易
✅ **完全な回帰防止** - テストカバレッジ > 80%
✅ **恒久的な対策** - 再発率 < 5%

---

**エラーハンター君 v1.0.0**

世界最高のエラー解析・修正を、あなたのプロジェクトに。

📧 サポート: [GitHub Issues](https://github.com/YOUR_REPO/issues)
📚 ドキュメント: [README.md](./README.md)
💬 コミュニティ: [Discussions](https://github.com/YOUR_REPO/discussions)
